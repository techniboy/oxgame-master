<link rel="import" href="../polymer/polymer.html"> 

<!--
This element initializes the PubNub client. This element must be created before attempting to utilize any other PubNub Polymer elements in order to establih account level credentials such as `publish_key` and `subscribe_key`, set `origin` server as well as any optional configurations such as `uuid`.

### Basic Usage:

    <core-pubnub publish_key="demo" subscribe_key="demo"></core-pubnub>

@element core-pubnub
@blurb Element providing encapsulation of the PubNub JS SDK.
@status alpha
@homepage 
-->
<polymer-element name="core-pubnub" hidden constructor="corePubNub" attributes="publish_key subscribe_key auth_key origin uuid cipher_key noleave keepalive secret_key ssl windwoing jsonp done pubnub">
  <script src="https://cdn.pubnub.com/pubnub.js"></script>

  <script>
    Polymer({

	    is: 'core-pubnub',
	    
      /**
        * The `publish_key` attribute sets the publish_key that will be used when publishing messages to a channel.
        * 
        * **REQUIRED**
        *
        * @attribute publish_key
        * @type String
        * @default ''
        */
      publish_key: '',

      /**
        * The `subscribe_key` attribute sets the subscribe_key that will be used when subscribing to a channel.
        * 
        * **REQUIRED**
        *
        * @attribute subscribe_key
        * @type String
        * @default ''
        */
      subscribe_key: '',

      /**
        * The `auth_key` attribute sets the auth_key to be used for determining User-Level Access Manager permissions.
        *
        * **OPTIONAL**
        *
        * @attribute auth_key 
        * @type String
        * @default undefined
        */

      /**
        * The `origin` attribute specifies the URL of the PubNub server you are connecting to.
        *
        * **OPTIONAL**
        *
        * @attribute origin
        * @type String
        * @default undefined
        */
      
      /**
        * The `uuid` attribute sets the unique user id to be used to identify the client. By default a randomly generated uuid is created by the client.
        *
        * **OPTIONAL**
        *
        * @attribute uuid
        * @type String
        * @default undefined
        */

      /**
        * The `cipher_key` attribute sets the cryptographic key to use for message level encryption with AES.
        *
        * **OPTIONAL**
        *
        * @attribute cipher_key
        * @type String
        * @default undefined
        */

      /**
        * The `noleave` attribute, when set to true, explicitly disables presence leave events.
        *
        * **OPTIONAL**
        *
        * @attribute noleave
        * @type Boolean
        * @default false
        */

      /**
        * The `keepalive` attribute sets the interval betwween keepalive pings. Defaults to 60 seconds.
        *
        * **OPTIONAL**
        *
        * @attribute keepalive 
        * @type Number
        * @default 60
        */

      /**
        * The `secret_key` attribute sets the secret_key used only to sign Access Manager API messages.
        *
        * **OPTIONAL**
        *
        * @attribute secret_key
        * @type String
        * @default undefined 
        */

      /**
        * The `ssl` attribute, when set to true, enables transport layer encryption with SSL/TLS. 
        *
        * **OPTIONAL**
        *
        * @attribute ssl 
        * @type Boolean
        * @default false
        */

      /**
        * The `windowing` sets the time interval in milliseconds that PubNub will use to optimize message delivery by bundling them into a single compressed payload.
        *
        * **OPTIONAL**
        *
        * @attribute windowing
        * @type number
        * @default undefined
        */

      /**
       * The `jsonp` attribute, when set to true, explicitly enforces JSON(P) as the data transport method.
        *
        * **OPTIONAL**
       *
       * @attribute jsonp
       * @type boolean
       * @default undefined
       */

      ready: function() {
          var settings = {
            publish_key: this.publish_key,
            subscribe_key: this.subscribe_key,
            auth_key: this.auth_key,
            uuid: this.uuid,
            cipher_key: this.cipher_key,
            noleave: this.noleave,
            keepalive: this.keepalive,
            secret_key: this.secret_key,
            ssl: this.ssl,
            windowing: this.windowing,
            jsonp: this.jsonp
          }
          // console.log("CORE READY");
          this.pubnub = PUBNUB.init(settings);
          this.fire('ready', this.pubnub);
          this.done = true;
      },
      auth_keyChanged: function(oldValue, newValue) {
        this.ready();
      },
      publish_keyChanged: function(oldValue, newValue) {
        this.ready();
      },
      subscribe_keyChanged: function(oldValue, newValue) {
        this.ready();
      },
      uuidChanged: function(oldValue, newValue) {
        this.ready();
      },
      cipher_keyChanged: function(oldValue, newValue) {
        this.ready();
      },
      noleaveChanged: function(oldValue, newValue) {
        this.ready();
      },
      keepaliveChanged: function(oldValue, newValue) {
        this.ready();
      },
      secret_keyChanged: function(oldValue, newValue) {
        this.ready();
      },
      sslChanged: function(oldValue, newValue) {
        this.ready();
      },
      windowingChanged: function(oldValue, newValue) {
        this.ready();
      },
      jsonpChanged: function(oldValue, newValue) {
        this.ready();
      },
    });
  </script>
</polymer-element>